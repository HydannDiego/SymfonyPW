{% extends 'base.html.twig' %}

{% block title %}Statistiques du site{% endblock %}

{% block body %}-

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="p-1 mb-6 ">
        {#                    STATISTIQUE : Nombre de biens par catégorie#}
        <div class="grid grid-flow-col mb-8">
            <div class="chart-container p-5" style="height:50vh; width:50vw">
                <h1 class="mt-6 text-white bg-green-500 font-bold rounded-lg border shadow-lg content-center justify-items-center p-2">
                    STATISTIQUE : Nombre de biens par catégorie
                </h1>
                <canvas id="chart"></canvas>
                <script>
                    const ctx = document.getElementById('chart').getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: [
                                {% for cat in categories %}
                                '{{ cat.intitule }}',
                                {% endfor %}
                            ],
                            datasets: [{
                                label: 'Nombre de biens par catégorie',
                                data: [
                                    {% for i in 0..countSorted|length-1 %}
                                    {{ countSorted[i]["nombre"] }},
                                    {% endfor %}
                                ],
                                backgroundColor: [
                                    {% for i in 0..countSorted|length-1 %}
                                    {% set r = random(0,100) %}
                                    {% set g = random(200,255) %}
                                    {% set b = random(140,255) %}
                                    'rgb({{ r }}, {{ g }}, {{ b }})',
                                    {% endfor %}
                                ],
                            }],
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Diagramme du nombre de biens par catégorie'
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>
        {#                    STATISTIQUE : Nombre de biens par ville#}
        <div class="grid grid-flow-col mb-8">
            <div class="chart-container p-5" style="height:60vh; width:60vw">
                <h1 class="mt-6 text-white bg-green-500 font-bold rounded-lg border shadow-lg content-center justify-items-center p-2">
                    STATISTIQUE : Nombre de biens par ville
                </h1>
                <canvas id="chart9"></canvas>
                <script>
                    const ctx9 = document.getElementById('chart9').getContext('2d');
                    const chart9 = new Chart(ctx9, {
                        type: 'doughnut',
                        data: {
                            labels: [
                                {% for i in 0..countByCity|length-1 %}
                                '{{ countByCity[i]["city"] }}',
                                {% endfor %}
                            ],
                            datasets: [{
                                label: 'Nombre de biens par ville',
                                data: [
                                    {% for i in 0..countByCity|length-1 %}
                                    {{ countByCity[i]["max"] }},
                                    {% endfor %}
                                ],
                                backgroundColor: [
                                    {% for i in 0..countByCity|length-1 %}
                                    {% set r = 0 %}
                                    {% set g = random(100,200) %}
                                    {% set b = random(150,255) %}
                                    'rgb({{ r }}, {{ g }}, {{ b }})',
                                    // 'rgb(0,113,206)',
                                    {% endfor %}
                                ],
                            }],
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Diagramme du nombre de biens par ville'
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>
        {#                    STATISTIQUE : Nombre de favoris créés au mois#}
        <div class="grid grid-flow-col mb-8">
            <div class="chart-container p-5" style="height:40vh; width:40vw">
                <h1 class="mt-6 text-white bg-green-500 font-bold rounded-lg border shadow-lg content-center justify-items-center p-2">
                    STATISTIQUE : Nombre de favoris créés au mois
                </h1>
                <canvas id="chart2"></canvas>
                <script>
                    {% set months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'] %}
                    {% set dataMonths = []%}
                    {% for i in 1..12 %}
                    {% set status = false %}
                    {% for j in 0..countByMonth|length-1 %}
                    {% if countByMonth[j] is defined and countByMonth[j]["month"] == i %}
                    {% set dataMonths = dataMonths|merge([countByMonth[j]["count"]]) %}
                    {% set status = true %}
                    {% endif %}
                    {% endfor %}
                    {% if status == false %}
                    {% set dataMonths = dataMonths|merge([0]) %}
                    {% endif %}
                    {% endfor %}
                    const ctx2 = document.getElementById('chart2').getContext('2d');
                    const data2 = {
                        labels: {{ months|json_encode|raw }},
                        datasets: [{
                            label: 'Nombre de favoris créés au mois',
                            data: [
                                {% for i in 0..dataMonths|length-1 %}
                                {{ dataMonths[i] }},
                                {% endfor %}
                            ],
                            fill: false,
                            borderColor: 'red',
                            tension: 0.1
                        }]
                    };
                    const chart2 = new Chart(ctx2, {
                        type: 'line',
                        data: data2,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Diagramme du nombre de favoris créés au mois'
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>
        {#                    STATISTIQUE : Nombre de favoris créés à l'année#}
        <div class="grid grid-flow-col mb-8">
            <div class="chart-container p-5" style="height:40vh; width:40vw">
                <h1 class="mt-6 text-white bg-green-500 font-bold rounded-lg border shadow-lg content-center justify-items-center p-2">
                    STATISTIQUE : Nombre de favoris créés par an
                </h1>
                <canvas id="chartYEAR"></canvas>
                <script>
                    {% set years = ['2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033'] %}
                    {% set dataYears = []%}
                    {% for i in 1..years|length %}
                    {% set status = false %}
                    {% for j in 0..countByYear|length-1 %}
                    {% if countByYear[j] is defined and countByYear[j]["year"] == i+2021 %}
                    {% set dataYears = dataYears|merge([countByYear[j]["count"]]) %}
                    {% set status = true %}
                    {% endif %}
                    {% endfor %}
                    {% if status == false %}
                    {% set dataYears = dataYears|merge([0]) %}
                    {% endif %}
                    {% endfor %}
                    const ctxYEAR = document.getElementById('chartYEAR').getContext('2d');
                    const dataYEAR = {
                        labels: {{ years|json_encode|raw }},
                        datasets: [{
                            label: 'Nombre de favoris créés par an',
                            data: [
                                {% for i in 0..dataYears|length-1 %}
                                {{ dataYears[i] }},
                                {% endfor %}
                            ],
                            fill: false,
                            borderColor: 'red',
                            tension: 0.1
                        }]
                    };
                    const chartYEAR = new Chart(ctxYEAR, {
                        type: 'line',
                        data: dataYEAR,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Diagramme du nombre de favoris créés par an'
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>
    </div>
{% endblock %}
